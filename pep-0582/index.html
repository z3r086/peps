
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 582 – Python local packages directory | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-0582/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://www.python.org/dev/peps/peps.rss">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 582</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 582 – Python local packages directory</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Kushal Das &lt;mail&#32;&#97;t&#32;kushaldas.in&gt;, Steve Dower &lt;steve.dower&#32;&#97;t&#32;python.org&gt;,
Donald Stufft &lt;donald&#32;&#97;t&#32;stufft.io&gt;, Nick Coghlan &lt;ncoghlan&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Discussions-To<span class="colon">:</span></dt>
<dd class="field-even"><a class="reference external" href="https://discuss.python.org/t/pep-582-python-local-packages-directory/963/">Discourse thread</a></dd>
<dt class="field-odd">Status<span class="colon">:</span></dt>
<dd class="field-odd">Draft</dd>
<dt class="field-even">Type<span class="colon">:</span></dt>
<dd class="field-even">Standards Track</dd>
<dt class="field-odd">Topic<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="/topic/packaging/">Packaging</a></dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">16-May-2018</dd>
<dt class="field-odd">Python-Version<span class="colon">:</span></dt>
<dd class="field-odd">3.12</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations">Security Considerations</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a><ul>
<li><a class="reference internal" href="#impact-on-other-python-implementations">Impact on other Python implementations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP proposes to add to Python a mechanism to automatically recognize a
<code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory and prefer importing packages installed in this
location over user or global site-packages. This will avoid the steps to create,
activate or deactivate “virtual environments”. Python will use the
<code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> from the base directory of the script when present.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation" role="doc-backlink">Motivation</a></h2>
<p>Python virtual environments have become an essential part of development and
teaching workflow in the community, but at the same time, they create a barrier
to entry for many. The following are a few of the issues people run into while
being introduced to Python (or programming for the first time).</p>
<ul class="simple">
<li>How virtual environments work is a lot of information for anyone new. It takes
a lot of extra time and effort to explain them.</li>
<li>Different platforms and shell environments require different sets of commands
to activate the virtual environments. Any workshop or teaching environment with
people coming with different operating systems installed on their laptops create a
lot of confusion among the participants.</li>
<li>Virtual environments need to be activated on each opened terminal. If someone
creates/opens a new terminal, that by default does not get the same environment
as in a previous terminal with virtual environment activated.</li>
</ul>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification" role="doc-backlink">Specification</a></h2>
<p>When the Python binary is executed, it attempts to determine its prefix (as
stored in <code class="docutils literal notranslate"><span class="pre">sys.prefix</span></code>), which is then used to find the standard library and
other key files, and by the <code class="docutils literal notranslate"><span class="pre">site</span></code> module to determine the location of the
<code class="docutils literal notranslate"><span class="pre">site-package</span></code> directories.  Currently the prefix is found – assuming
<code class="docutils literal notranslate"><span class="pre">PYTHONHOME</span></code> is not set – by first walking up the filesystem tree looking for
a marker file (<code class="docutils literal notranslate"><span class="pre">os.py</span></code>) that signifies the presence of the standard library,
and if none is found, falling back to the build-time prefix hard coded in the
binary. The result of this process is the contents of <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> - a list of
locations that the Python import system will search for modules.</p>
<p>This PEP proposes to add a new step in this process. If a <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code>
directory is found in the current working directory, then it will be included in
<code class="docutils literal notranslate"><span class="pre">sys.path</span></code> after the current working directory and just before the system
site-packages. This way, if the Python executable starts in the given project
directory, it will automatically find all the dependencies inside of
<code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code>.</p>
<p>In case of Python scripts, Python will try to find <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> in the
same directory as the script. If found (along with the current Python version
directory inside), then it will be used, otherwise Python will behave as it does
currently.</p>
<p>If any package management tool finds the same <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory in
the current working directory, it will install any packages there and also
create it if required based on Python version.</p>
<p>Projects that use a source management system can include a <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code>
directory (empty or with e.g. a file like <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code>). After doing a fresh
check out the source code, a tool like <code class="docutils literal notranslate"><span class="pre">pip</span></code> can be used to install the
required dependencies directly into this directory.</p>
<section id="example">
<h3><a class="toc-backref" href="#example" role="doc-backlink">Example</a></h3>
<p>The following shows an example project directory structure, and different ways
the Python executable and any script will behave.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span>
    <span class="n">__pypackages__</span>
        <span class="n">lib</span>
            <span class="n">python3</span><span class="mf">.10</span>
                       <span class="n">site</span><span class="o">-</span><span class="n">packages</span>
                                     <span class="n">bottle</span>
    <span class="n">myscript</span><span class="o">.</span><span class="n">py</span>

<span class="o">/&gt;</span> <span class="n">python</span> <span class="n">foo</span><span class="o">/</span><span class="n">myscript</span><span class="o">.</span><span class="n">py</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;foo/__pypackages__/lib/python3.10/site-packages/&#39;</span>


<span class="n">cd</span> <span class="n">foo</span>

<span class="n">foo</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ansible</span>
    <span class="c1">#! /usr/bin/env python3</span>
<span class="n">foo</span><span class="o">&gt;</span> <span class="n">python</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ansible</span>

<span class="n">foo</span><span class="o">&gt;</span> <span class="n">python</span> <span class="n">myscript</span><span class="o">.</span><span class="n">py</span>

<span class="n">foo</span><span class="o">&gt;</span> <span class="n">python</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;./__pypackages__/lib/python3.10/site-packages&#39;</span>

<span class="n">foo</span><span class="o">&gt;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">bottle</span>
</pre></div>
</div>
<p>We have a project directory called <code class="docutils literal notranslate"><span class="pre">foo</span></code> and it has a <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code>
inside of it. We have <code class="docutils literal notranslate"><span class="pre">bottle</span></code> installed in that
<code class="docutils literal notranslate"><span class="pre">__pypackages__/lib/python3.10/stie-packages/</span></code>, and have a <code class="docutils literal notranslate"><span class="pre">myscript.py</span></code>
file inside of the project directory. We have used whatever tool we generally
use to install <code class="docutils literal notranslate"><span class="pre">bottle</span></code> in that location. This actual internal path will
depend on the Python implementation name, as mentioned in the
<code class="docutils literal notranslate"><span class="pre">sysconfig._INSTALL_SCHEMES['posix_prefix']</span></code> dictionary.</p>
<p>For invoking a script, Python will try to find a <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> inside of
the directory that the script resides[1]_, <code class="docutils literal notranslate"><span class="pre">/usr/bin</span></code>.  The same will happen
in case of the last example, where we are executing <code class="docutils literal notranslate"><span class="pre">/usr/bin/ansible</span></code> from
inside of the <code class="docutils literal notranslate"><span class="pre">foo</span></code> directory. In both cases, it will <strong>not</strong> use the
<code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> in the current working directory.</p>
<p>Similarly, if we invoke <code class="docutils literal notranslate"><span class="pre">myscript.py</span></code> from the first example, it will use the
<code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory that was in the <code class="docutils literal notranslate"><span class="pre">foo</span></code> directory.</p>
<p>If we go inside of the <code class="docutils literal notranslate"><span class="pre">foo</span></code> directory and start the Python executable (the
interpreter), it will find the <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory inside of the
current working directory and use it in the <code class="docutils literal notranslate"><span class="pre">sys.path</span></code>. The same happens if we
try to use the <code class="docutils literal notranslate"><span class="pre">-m</span></code> and use a module. In our example, <code class="docutils literal notranslate"><span class="pre">bottle</span></code> module will
be found inside of the <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory.</p>
<p>The above two examples are only cases where <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> from current
working directory is used.</p>
<p>In another example scenario, a trainer of a Python class can say “Today we are
going to learn how to use Twisted! To start, please checkout our example
project, go to that directory, and then run <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">twisted</span></code>.”</p>
<p>That will install Twisted into a directory separate from <code class="docutils literal notranslate"><span class="pre">python3</span></code>. There’s no
need to discuss virtual environments, global versus user installs, etc. as the
install will be local by default. The trainer can then just keep telling them to
use <code class="docutils literal notranslate"><span class="pre">python3</span></code> without any activation step, etc.</p>
</section>
</section>
<section id="security-considerations">
<h2><a class="toc-backref" href="#security-considerations" role="doc-backlink">Security Considerations</a></h2>
<p>While executing a Python script, it will not consider the <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> in
the current directory, instead if there is a <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory in the
same path of the script, that will be used.</p>
<p>For example, if we execute <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">/usr/share/myproject/fancy.py</span></code> from the
<code class="docutils literal notranslate"><span class="pre">/tmp</span></code> directory and  if there is a <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory inside of
<code class="docutils literal notranslate"><span class="pre">/usr/share/myproject/</span></code> directory, it will be used. Any potential
<code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> will be ignored.</p>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility" role="doc-backlink">Backwards Compatibility</a></h2>
<p>This does not affect any older version of Python implementation.</p>
<section id="impact-on-other-python-implementations">
<h3><a class="toc-backref" href="#impact-on-other-python-implementations" role="doc-backlink">Impact on other Python implementations</a></h3>
<p>Other Python implementations will need to replicate the new behavior of the
interpreter bootstrap, including locating the <code class="docutils literal notranslate"><span class="pre">__pypackages__</span></code> directory and
adding it the <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> just before site packages, if it is present.</p>
</section>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference Implementation</a></h2>
<p><a class="reference external" href="https://github.com/kushaldas/pep582">Here</a> is a small script which will
enable the implementation for <code class="docutils literal notranslate"><span class="pre">Cpython</span></code> &amp; in <code class="docutils literal notranslate"><span class="pre">PyPy</span></code>.</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas" role="doc-backlink">Rejected Ideas</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">__pylocal__</span></code> and <code class="docutils literal notranslate"><span class="pre">python_modules</span></code>.</p>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/pep-0582.rst">https://github.com/python/peps/blob/main/pep-0582.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/pep-0582.rst">2022-08-06 19:31:05 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-considerations">Security Considerations</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a><ul>
<li><a class="reference internal" href="#impact-on-other-python-implementations">Impact on other Python implementations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/pep-0582.rst">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
</body>
</html>