
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>PEP 3147 – PYC Repository Directories | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png">
    <link rel="canonical" href="https://peps.python.org/pep-3147/">
    <link rel="stylesheet" href="../_static/style.css" type="text/css">
    <link rel="stylesheet" href="../_static/mq.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg-light">
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark">
    <link rel="alternate" type="application/rss+xml" title="Latest PEPs" href="https://www.python.org/dev/peps/peps.rss">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)">
</head>
<body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-sun-half" viewBox="0 0 24 24" pointer-events="all">
    <title>Following system colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="9"></circle>
      <path d="M12 3v18m0-12l4.65-4.65M12 14.3l7.37-7.37M12 19.6l8.85-8.85"></path>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected dark colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24" pointer-events="all">
    <title>Selected light colour scheme</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
</svg>
    <script>

        document.documentElement.dataset.colour_scheme = localStorage.getItem("colour_scheme") || "auto"
    </script>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 3147</li>
            </ul>
            <button id="colour-scheme-cycler" onClick="setColourScheme(nextColourScheme())">
                <svg aria-hidden="true" class="colour-scheme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-dark"><use href="#svg-moon"></use></svg>
                <svg aria-hidden="true" class="colour-scheme-icon-when-light"><use href="#svg-sun"></use></svg>
                <span class="visually-hidden">Toggle light / dark / auto colour theme</span>
            </button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 3147 – PYC Repository Directories</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd">Barry Warsaw &lt;barry&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-even">Status<span class="colon">:</span></dt>
<dd class="field-even">Final</dd>
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd">Standards Track</dd>
<dt class="field-even">Created<span class="colon">:</span></dt>
<dd class="field-even">16-Dec-2009</dd>
<dt class="field-odd">Python-Version<span class="colon">:</span></dt>
<dd class="field-odd">3.2</dd>
<dt class="field-even">Post-History<span class="colon">:</span></dt>
<dd class="field-even">30-Jan-2010, 25-Feb-2010, 03-Mar-2010, 12-Apr-2010</dd>
<dt class="field-odd">Resolution<span class="colon">:</span></dt>
<dd class="field-odd"><a class="reference external" href="https://mail.python.org/pipermail/python-dev/2010-April/099414.html">Python-Dev message</a></dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Table of Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#proposal">Proposal</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-behavior">Python behavior</a><ul>
<li><a class="reference internal" href="#case-0-the-steady-state">Case 0: The steady state</a></li>
<li><a class="reference internal" href="#case-1-the-first-import">Case 1: The first import</a></li>
<li><a class="reference internal" href="#case-2-the-second-import">Case 2: The second import</a></li>
<li><a class="reference internal" href="#case-3-pycache-foo-magic-pyc-with-no-source">Case 3: __pycache__/foo.&lt;magic&gt;.pyc with no source</a></li>
<li><a class="reference internal" href="#case-4-legacy-pyc-files-and-source-less-imports">Case 4: legacy pyc files and source-less imports</a></li>
<li><a class="reference internal" href="#case-5-read-only-file-systems">Case 5: read-only file systems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flow-chart">Flow chart</a></li>
<li><a class="reference internal" href="#alternative-python-implementations">Alternative Python implementations</a></li>
<li><a class="reference internal" href="#implementation-strategy">Implementation strategy</a></li>
<li><a class="reference internal" href="#effects-on-existing-code">Effects on existing code</a><ul>
<li><a class="reference internal" href="#detecting-pep-3147-availability">Detecting PEP 3147 availability</a></li>
<li><a class="reference internal" href="#file">__file__</a></li>
<li><a class="reference internal" href="#py-compile-and-compileall">py_compile and compileall</a></li>
<li><a class="reference internal" href="#bdist-wininst-and-the-windows-installer">bdist_wininst and the Windows installer</a></li>
<li><a class="reference internal" href="#file-extension-checks">File extension checks</a></li>
<li><a class="reference internal" href="#backports">Backports</a></li>
<li><a class="reference internal" href="#makefiles-and-other-dependency-tools">Makefiles and other dependency tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alternatives">Alternatives</a><ul>
<li><a class="reference internal" href="#hexadecimal-magic-tags">Hexadecimal magic tags</a></li>
<li><a class="reference internal" href="#pep-304">PEP 304</a></li>
<li><a class="reference internal" href="#fat-byte-compilation-files">Fat byte compilation files</a></li>
<li><a class="reference internal" href="#multiple-file-extensions">Multiple file extensions</a></li>
<li><a class="reference internal" href="#pyc">.pyc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-implementation">Reference implementation</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#acknowledgments">ACKNOWLEDGMENTS</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract" role="doc-backlink">Abstract</a></h2>
<p>This PEP describes an extension to Python’s import mechanism which
improves sharing of Python source code files among multiple installed
different versions of the Python interpreter.  It does this by
allowing more than one byte compilation file (.pyc files) to be
co-located with the Python source file (.py file).  The extension
described here can also be used to support different Python
compilation caches, such as JIT output that may be produced by an
Unladen Swallow (<a class="pep reference internal" href="/pep-3146" title="PEP 3146 – Merging Unladen Swallow into CPython">PEP 3146</a>) enabled C Python.</p>
</section>
<section id="background">
<h2><a class="toc-backref" href="#background" role="doc-backlink">Background</a></h2>
<p>CPython compiles its source code into “byte code”, and for performance
reasons, it caches this byte code on the file system whenever the
source file has changes.  This makes loading of Python modules much
faster because the compilation phase can be bypassed.  When your
source file is <cite>foo.py</cite>, CPython caches the byte code in a <cite>foo.pyc</cite>
file right next to the source.</p>
<p>Byte code files contain two 32-bit big-endian numbers followed by the
marshaled <a class="footnote-reference brackets" href="#id22" id="id1">[2]</a> code object.  The 32-bit numbers represent a magic
number and a timestamp.  The magic number changes whenever Python
changes the byte code format, e.g. by adding new byte codes to its
virtual machine.  This ensures that pyc files built for previous
versions of the VM won’t cause problems.  The timestamp is used to
make sure that the pyc file match the py file that was used to create
it.  When either the magic number or timestamp do not match, the py
file is recompiled and a new pyc file is written.</p>
<p>In practice, it is well known that pyc files are not compatible across
Python major releases.  A reading of import.c <a class="footnote-reference brackets" href="#id23" id="id2">[3]</a> in the Python
source code proves that within recent memory, every new CPython major
release has bumped the pyc magic number.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale" role="doc-backlink">Rationale</a></h2>
<p>Linux distributions such as Ubuntu <a class="footnote-reference brackets" href="#id24" id="id3">[4]</a> and Debian <a class="footnote-reference brackets" href="#id25" id="id4">[5]</a> provide more
than one Python version at the same time to their users.  For example,
Ubuntu 9.10 Karmic Koala users can install Python 2.5, 2.6, and 3.1,
with Python 2.6 being the default.</p>
<p>This causes a conflict for third party Python source files installed
by the system, because you cannot compile a single Python source file
for more than one Python version at a time.  When Python finds a <cite>pyc</cite>
file with a non-matching magic number, it falls back to the slower
process of recompiling the source.  Thus if your system installed a
<cite>/usr/share/python/foo.py</cite>, two different versions of Python would
fight over the <cite>pyc</cite> file and rewrite it each time the source is
compiled.  (The standard library is unaffected by this, since multiple
versions of the stdlib <em>are</em> installed on such distributions..)</p>
<p>Furthermore, in order to ease the burden on operating system packagers
for these distributions, the distribution packages do not contain
Python version numbers <a class="footnote-reference brackets" href="#id26" id="id5">[6]</a>; they are shared across all Python
versions installed on the system.  Putting Python version numbers in
the packages would be a maintenance nightmare, since all the packages
- <em>and their dependencies</em> - would have to be updated every time a new
Python release was added or removed from the distribution.  Because of
the sheer number of packages available, this amount of work is
infeasible.</p>
<p>(<a class="pep reference internal" href="/pep-0384" title="PEP 384 – Defining a Stable ABI">PEP 384</a> has been proposed to address binary compatibility issues
of third party extension modules across different versions of Python.)</p>
<p>Because these distributions cannot share pyc files, elaborate
mechanisms have been developed to put the resulting pyc files in
non-shared locations while the source code is still shared.  Examples
include the symlink-based Debian regimes python-support <a class="footnote-reference brackets" href="#id27" id="id6">[8]</a> and
python-central <a class="footnote-reference brackets" href="#id28" id="id7">[9]</a>.  These approaches make for much more complicated,
fragile, inscrutable, and fragmented policies for delivering Python
applications to a wide range of users.  Arguably more users get Python
from their operating system vendor than from upstream tarballs.  Thus,
solving this pyc sharing problem for CPython is a high priority for
such vendors.</p>
<p>This PEP proposes a solution to this problem.</p>
</section>
<section id="proposal">
<h2><a class="toc-backref" href="#proposal" role="doc-backlink">Proposal</a></h2>
<p>Python’s import machinery is extended to write and search for byte
code cache files in a single directory inside every Python package
directory.  This directory will be called <cite>__pycache__</cite>.</p>
<p>Further, pyc file names will contain a magic string (called a “tag”)
that differentiates the Python version they were compiled for.  This
allows multiple byte compiled cache files to co-exist for a single
Python source file.</p>
<p>The magic tag is implementation defined, but should contain the
implementation name and a version number shorthand, e.g. <cite>cpython-32</cite>.
It must be unique among all versions of Python, and whenever the magic
number is bumped, a new magic tag must be defined.  An example <cite>pyc</cite>
file for Python 3.2 is thus <cite>foo.cpython-32.pyc</cite>.</p>
<p>The magic tag is available in the <cite>imp</cite> module via the <cite>get_tag()</cite>
function.  This is parallel to the <cite>imp.get_magic()</cite> function.</p>
<p>This scheme has the added benefit of reducing the clutter in a Python
package directory.</p>
<p>When a Python source file is imported for the first time, a
<cite>__pycache__</cite> directory will be created in the package directory, if
one does not already exist.  The pyc file for the imported source will
be written to the <cite>__pycache__</cite> directory, using the magic-tag
formatted name.  If either the creation of the <cite>__pycache__</cite> directory
or the pyc file inside that fails, the import will still succeed, just
as it does in a pre-<a class="pep reference internal" href="/pep-3147" title="PEP 3147 – PYC Repository Directories">PEP 3147</a> world.</p>
<p>If the py source file is missing, the pyc file inside <cite>__pycache__</cite>
will be ignored.  This eliminates the problem of accidental stale pyc
file imports.</p>
<p>For backward compatibility, Python will still support pyc-only
distributions, however it will only do so when the pyc file lives in
the directory where the py file <em>would</em> have been, i.e. not in the
<cite>__pycache__</cite> directory.  pyc file outside of <cite>__pycache__</cite> will only
be imported if the py source file is missing.</p>
<p>Tools such as <cite>py_compile</cite> <a class="footnote-reference brackets" href="#id34" id="id8">[15]</a> and <cite>compileall</cite> <a class="footnote-reference brackets" href="#id35" id="id9">[16]</a> will be
extended to create <a class="pep reference internal" href="/pep-3147" title="PEP 3147 – PYC Repository Directories">PEP 3147</a> formatted layouts automatically, but will
have an option to create pyc-only distribution layouts.</p>
<section id="examples">
<h3><a class="toc-backref" href="#examples" role="doc-backlink">Examples</a></h3>
<p>What would this look like in practice?</p>
<p>Let’s say we have a Python package named <cite>alpha</cite> which contains a
sub-package name <cite>beta</cite>.  The source directory layout before byte
compilation might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="o">/</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="n">one</span><span class="o">.</span><span class="n">py</span>
    <span class="n">two</span><span class="o">.</span><span class="n">py</span>
    <span class="n">beta</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">three</span><span class="o">.</span><span class="n">py</span>
        <span class="n">four</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>After byte compiling this package with Python 3.2, you would see the
following layout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="o">/</span>
    <span class="n">__pycache__</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
        <span class="n">one</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
        <span class="n">two</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="n">one</span><span class="o">.</span><span class="n">py</span>
    <span class="n">two</span><span class="o">.</span><span class="n">py</span>
    <span class="n">beta</span><span class="o">/</span>
        <span class="n">__pycache__</span><span class="o">/</span>
            <span class="fm">__init__</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
            <span class="n">three</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
            <span class="n">four</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">three</span><span class="o">.</span><span class="n">py</span>
        <span class="n">four</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><em>Note: listing order may differ depending on the platform.</em></p>
<p>Let’s say that two new versions of Python are installed, one is Python
3.3 and another is Unladen Swallow.  After byte compilation, the file
system would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="o">/</span>
    <span class="n">__pycache__</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">33.</span><span class="n">pyc</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">unladen</span><span class="o">-</span><span class="mf">10.</span><span class="n">pyc</span>
        <span class="n">one</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
        <span class="n">one</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">33.</span><span class="n">pyc</span>
        <span class="n">one</span><span class="o">.</span><span class="n">unladen</span><span class="o">-</span><span class="mf">10.</span><span class="n">pyc</span>
        <span class="n">two</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
        <span class="n">two</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">33.</span><span class="n">pyc</span>
        <span class="n">two</span><span class="o">.</span><span class="n">unladen</span><span class="o">-</span><span class="mf">10.</span><span class="n">pyc</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="n">one</span><span class="o">.</span><span class="n">py</span>
    <span class="n">two</span><span class="o">.</span><span class="n">py</span>
    <span class="n">beta</span><span class="o">/</span>
        <span class="n">__pycache__</span><span class="o">/</span>
            <span class="fm">__init__</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
            <span class="fm">__init__</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">33.</span><span class="n">pyc</span>
            <span class="fm">__init__</span><span class="o">.</span><span class="n">unladen</span><span class="o">-</span><span class="mf">10.</span><span class="n">pyc</span>
            <span class="n">three</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
            <span class="n">three</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">33.</span><span class="n">pyc</span>
            <span class="n">three</span><span class="o">.</span><span class="n">unladen</span><span class="o">-</span><span class="mf">10.</span><span class="n">pyc</span>
            <span class="n">four</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">32.</span><span class="n">pyc</span>
            <span class="n">four</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">33.</span><span class="n">pyc</span>
            <span class="n">four</span><span class="o">.</span><span class="n">unladen</span><span class="o">-</span><span class="mf">10.</span><span class="n">pyc</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">three</span><span class="o">.</span><span class="n">py</span>
        <span class="n">four</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>As you can see, as long as the Python version identifier string is
unique, any number of pyc files can co-exist.  These identifier
strings are described in more detail below.</p>
<p>A nice property of this layout is that the <cite>__pycache__</cite> directories
can generally be ignored, such that a normal directory listing would
show something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span><span class="o">/</span>
    <span class="n">__pycache__</span><span class="o">/</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
    <span class="n">one</span><span class="o">.</span><span class="n">py</span>
    <span class="n">two</span><span class="o">.</span><span class="n">py</span>
    <span class="n">beta</span><span class="o">/</span>
        <span class="n">__pycache__</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">three</span><span class="o">.</span><span class="n">py</span>
        <span class="n">four</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This is much less cluttered than even today’s Python.</p>
</section>
</section>
<section id="python-behavior">
<h2><a class="toc-backref" href="#python-behavior" role="doc-backlink">Python behavior</a></h2>
<p>When Python searches for a module to import (say <cite>foo</cite>), it may find
one of several situations.  As per current Python rules, the term
“matching pyc” means that the magic number matches the current
interpreter’s magic number, and the source file’s timestamp matches
the timestamp in the <cite>pyc</cite> file exactly.</p>
<section id="case-0-the-steady-state">
<h3><a class="toc-backref" href="#case-0-the-steady-state" role="doc-backlink">Case 0: The steady state</a></h3>
<p>When Python is asked to import module <cite>foo</cite>, it searches for a
<cite>foo.py</cite> file (or <cite>foo</cite> package, but that’s not important for this
discussion) along its <cite>sys.path</cite>.  If found, Python looks to see if
there is a matching <cite>__pycache__/foo.&lt;magic&gt;.pyc</cite> file, and if so,
that <cite>pyc</cite> file is loaded.</p>
</section>
<section id="case-1-the-first-import">
<h3><a class="toc-backref" href="#case-1-the-first-import" role="doc-backlink">Case 1: The first import</a></h3>
<p>When Python locates the <cite>foo.py</cite>, if the <cite>__pycache__/foo.&lt;magic&gt;.pyc</cite>
file is missing, Python will create it, also creating the
<cite>__pycache__</cite> directory if necessary.  Python will parse and byte
compile the <cite>foo.py</cite> file and save the byte code in
<cite>__pycache__/foo.&lt;magic&gt;.pyc</cite>.</p>
</section>
<section id="case-2-the-second-import">
<h3><a class="toc-backref" href="#case-2-the-second-import" role="doc-backlink">Case 2: The second import</a></h3>
<p>When Python is asked to import module <cite>foo</cite> a second time (in a
different process of course), it will again search for the <cite>foo.py</cite>
file along its <cite>sys.path</cite>.  When Python locates the <cite>foo.py</cite> file, it
looks for a matching <cite>__pycache__/foo.&lt;magic&gt;.pyc</cite> and finding this,
it reads the byte code and continues as usual.</p>
</section>
<section id="case-3-pycache-foo-magic-pyc-with-no-source">
<h3><a class="toc-backref" href="#case-3-pycache-foo-magic-pyc-with-no-source" role="doc-backlink">Case 3: __pycache__/foo.&lt;magic&gt;.pyc with no source</a></h3>
<p>It’s possible that the <cite>foo.py</cite> file somehow got removed, while
leaving the cached pyc file still on the file system.  If the
<cite>__pycache__/foo.&lt;magic&gt;.pyc</cite> file exists, but the <cite>foo.py</cite> file used
to create it does not, Python will raise an <cite>ImportError</cite> when asked
to import foo.  In other words, Python will not import a pyc file from
the cache directory unless the source file exists.</p>
</section>
<section id="case-4-legacy-pyc-files-and-source-less-imports">
<h3><a class="toc-backref" href="#case-4-legacy-pyc-files-and-source-less-imports" role="doc-backlink">Case 4: legacy pyc files and source-less imports</a></h3>
<p>Python will ignore all legacy pyc files when a source file exists next
to it.  In other words, if a <cite>foo.pyc</cite> file exists next to the
<cite>foo.py</cite> file, the pyc file will be ignored in all cases</p>
<p>In order to continue to support source-less distributions though, if
the source file is missing, Python will import a lone pyc file if it
lives where the source file would have been.</p>
</section>
<section id="case-5-read-only-file-systems">
<h3><a class="toc-backref" href="#case-5-read-only-file-systems" role="doc-backlink">Case 5: read-only file systems</a></h3>
<p>When the source lives on a read-only file system, or the <cite>__pycache__</cite>
directory or pyc file cannot otherwise be written, all the same rules
apply.  This is also the case when <cite>__pycache__</cite> happens to be written
with permissions which do not allow for writing containing pyc files.</p>
</section>
</section>
<section id="flow-chart">
<h2><a class="toc-backref" href="#flow-chart" role="doc-backlink">Flow chart</a></h2>
<p>Here is a flow chart describing how modules are loaded:</p>
<a class="invert-in-dark-mode reference internal image-reference" href="../_images/pep-3147-1.png"><img alt="../_images/pep-3147-1.png" class="invert-in-dark-mode" src="../_images/pep-3147-1.png" style="width: 777.75px; height: 609.0px;" /></a>
</section>
<section id="alternative-python-implementations">
<h2><a class="toc-backref" href="#alternative-python-implementations" role="doc-backlink">Alternative Python implementations</a></h2>
<p>Alternative Python implementations such as Jython <a class="footnote-reference brackets" href="#id30" id="id10">[11]</a>, IronPython
<a class="footnote-reference brackets" href="#id31" id="id11">[12]</a>, PyPy <a class="footnote-reference brackets" href="#id32" id="id12">[13]</a>, Pynie <a class="footnote-reference brackets" href="#id33" id="id13">[14]</a>, and Unladen Swallow can also use the
<cite>__pycache__</cite> directory to store whatever compilation artifacts make
sense for their platforms.  For example, Jython could store the class
file for the module in <cite>__pycache__/foo.jython-32.class</cite>.</p>
</section>
<section id="implementation-strategy">
<h2><a class="toc-backref" href="#implementation-strategy" role="doc-backlink">Implementation strategy</a></h2>
<p>This feature is targeted for Python 3.2, solving the problem for those
and all future versions.  It may be back-ported to Python 2.7.
Vendors are free to backport the changes to earlier distributions as
they see fit.  For backports of this feature to Python 2, when the
<cite>-U</cite> flag is used, a file such as <cite>foo.cpython-27u.pyc</cite> can be
written.</p>
</section>
<section id="effects-on-existing-code">
<h2><a class="toc-backref" href="#effects-on-existing-code" role="doc-backlink">Effects on existing code</a></h2>
<p>Adoption of this PEP will affect existing code and idioms, both inside
Python and outside.  This section enumerates some of these effects.</p>
<section id="detecting-pep-3147-availability">
<h3><a class="toc-backref" href="#detecting-pep-3147-availability" role="doc-backlink">Detecting PEP 3147 availability</a></h3>
<p>The easiest way to detect whether your version of Python provides PEP
3147 functionality is to do the following check:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">imp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">has3147</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">imp</span><span class="p">,</span> <span class="s1">&#39;get_tag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="file">
<h3><a class="toc-backref" href="#file" role="doc-backlink">__file__</a></h3>
<p>In Python 3, when you import a module, its <cite>__file__</cite> attribute points
to its source <cite>py</cite> file (in Python 2, it points to the <cite>pyc</cite> file).  A
package’s <cite>__file__</cite> points to the <cite>py</cite> file for its <cite>__init__.py</cite>.
E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">foo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="vm">__file__</span>
<span class="go">&#39;foo.py&#39;</span>
<span class="go"># baz is a package</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">baz</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">baz</span><span class="o">.</span><span class="vm">__file__</span>
<span class="go">&#39;baz/__init__.py&#39;</span>
</pre></div>
</div>
<p>Nothing in this PEP would change the semantics of <cite>__file__</cite>.</p>
<p>This PEP proposes the addition of an <cite>__cached__</cite> attribute to
modules, which will always point to the actual <cite>pyc</cite> file that was
read or written.  When the environment variable
<cite>$PYTHONDONTWRITEBYTECODE</cite> is set, or the <cite>-B</cite> option is given, or if
the source lives on a read-only filesystem, then the <cite>__cached__</cite>
attribute will point to the location that the <cite>pyc</cite> file <em>would</em> have
been written to if it didn’t exist.  This location of course includes
the <cite>__pycache__</cite> subdirectory in its path.</p>
<p>For alternative Python implementations which do not support <cite>pyc</cite>
files, the <cite>__cached__</cite> attribute may point to whatever information
makes sense.  E.g. on Jython, this might be the <cite>.class</cite> file for the
module: <cite>__pycache__/foo.jython-32.class</cite>.  Some implementations may
use multiple compiled files to create the module, in which case
<cite>__cached__</cite> may be a tuple.  The exact contents of <cite>__cached__</cite> are
Python implementation specific.</p>
<p>It is recommended that when nothing sensible can be calculated,
implementations should set the <cite>__cached__</cite> attribute to <cite>None</cite>.</p>
</section>
<section id="py-compile-and-compileall">
<h3><a class="toc-backref" href="#py-compile-and-compileall" role="doc-backlink">py_compile and compileall</a></h3>
<p>Python comes with two modules, <cite>py_compile</cite> <a class="footnote-reference brackets" href="#id34" id="id14">[15]</a> and <cite>compileall</cite>
<a class="footnote-reference brackets" href="#id35" id="id15">[16]</a> which support compiling Python modules external to the built-in
import machinery.  <cite>py_compile</cite> in particular has intimate knowledge
of byte compilation, so these will be updated to understand the new
layout.  The <cite>-b</cite> flag is added to <cite>compileall</cite> for writing legacy
<cite>.pyc</cite> byte-compiled file path names.</p>
</section>
<section id="bdist-wininst-and-the-windows-installer">
<h3><a class="toc-backref" href="#bdist-wininst-and-the-windows-installer" role="doc-backlink">bdist_wininst and the Windows installer</a></h3>
<p>These tools also compile modules explicitly on installation.  If they
do not use <cite>py_compile</cite> and <cite>compileall</cite>, then they would also have to
be modified to understand the new layout.</p>
</section>
<section id="file-extension-checks">
<h3><a class="toc-backref" href="#file-extension-checks" role="doc-backlink">File extension checks</a></h3>
<p>There exists some code which checks for files ending in <cite>.pyc</cite> and
simply chops off the last character to find the matching <cite>.py</cite> file.
This code will obviously fail once this PEP is implemented.</p>
<p>To support this use case, we’ll add two new methods to the <cite>imp</cite>
package <a class="footnote-reference brackets" href="#id36" id="id16">[17]</a>:</p>
<ul class="simple">
<li><cite>imp.cache_from_source(py_path)</cite> -&gt; <cite>pyc_path</cite></li>
<li><cite>imp.source_from_cache(pyc_path)</cite> -&gt; <cite>py_path</cite></li>
</ul>
<p>Alternative implementations are free to override these functions to
return reasonable values based on their own support for this PEP.
These methods are allowed to return <cite>None</cite> when the implementation (or
<a class="pep reference internal" href="/pep-0302" title="PEP 302 – New Import Hooks">PEP 302</a> loader in effect) for whatever reason cannot calculate
the appropriate file name.  They should not raise exceptions.</p>
</section>
<section id="backports">
<h3><a class="toc-backref" href="#backports" role="doc-backlink">Backports</a></h3>
<p>For versions of Python earlier than 3.2 (and possibly 2.7), it is
possible to backport this PEP.  However, in Python 3.2 (and possibly
2.7), this behavior will be turned on by default, and in fact, it will
replace the old behavior.  Backports will need to support the old
layout by default.  We suggest supporting <a class="pep reference internal" href="/pep-3147" title="PEP 3147 – PYC Repository Directories">PEP 3147</a> through the use of
an environment variable called <cite>$PYTHONENABLECACHEDIR</cite> or the command
line switch <cite>-Xenablecachedir</cite> to enable the feature.</p>
</section>
<section id="makefiles-and-other-dependency-tools">
<h3><a class="toc-backref" href="#makefiles-and-other-dependency-tools" role="doc-backlink">Makefiles and other dependency tools</a></h3>
<p>Makefiles and other tools which calculate dependencies on <cite>.pyc</cite> files
(e.g. to byte-compile the source if the <cite>.pyc</cite> is missing) will have
to be updated to check the new paths.</p>
</section>
</section>
<section id="alternatives">
<h2><a class="toc-backref" href="#alternatives" role="doc-backlink">Alternatives</a></h2>
<p>This section describes some alternative approaches or details that
were considered and rejected during the PEP’s development.</p>
<section id="hexadecimal-magic-tags">
<h3><a class="toc-backref" href="#hexadecimal-magic-tags" role="doc-backlink">Hexadecimal magic tags</a></h3>
<p>pyc files inside of the <cite>__pycache__</cite> directories contain a magic tag
in their file names.  These are mnemonic tags for the actual magic
numbers used by the importer.  We could have used the hexadecimal
representation <a class="footnote-reference brackets" href="#id29" id="id17">[10]</a> of the binary magic number as a unique
identifier.  For example, in Python 3.2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">binascii</span> <span class="kn">import</span> <span class="n">hexlify</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">imp</span> <span class="kn">import</span> <span class="n">get_magic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;foo.</span><span class="si">{}</span><span class="s1">.pyc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hexlify</span><span class="p">(</span><span class="n">get_magic</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span>
<span class="go">&#39;foo.580c0d0a.pyc&#39;</span>
</pre></div>
</div>
<p>This isn’t particularly human friendly though, thus the magic tag
proposed in this PEP.</p>
</section>
<section id="pep-304">
<h3><a class="toc-backref" href="#pep-304" role="doc-backlink">PEP 304</a></h3>
<p>There is some overlap between the goals of this PEP and <a class="pep reference internal" href="/pep-0304" title="PEP 304 – Controlling Generation of Bytecode Files">PEP 304</a>,
which has been withdrawn.  However <a class="pep reference internal" href="/pep-0304" title="PEP 304 – Controlling Generation of Bytecode Files">PEP 304</a> would allow a user to
create a shadow file system hierarchy in which to store <cite>pyc</cite> files.
This concept of a shadow hierarchy for <cite>pyc</cite> files could be used to
satisfy the aims of this PEP.  Although the <a class="pep reference internal" href="/pep-0304" title="PEP 304 – Controlling Generation of Bytecode Files">PEP 304</a> does not indicate
why it was withdrawn, shadow directories have a number of problems.
The location of the shadow <cite>pyc</cite> files would not be easily discovered
and would depend on the proper and consistent use of the
<cite>$PYTHONBYTECODE</cite> environment variable both by the system and by end
users.  There are also global implications, meaning that while the
system might want to shadow <cite>pyc</cite> files, users might not want to, but
the PEP defines only an all-or-nothing approach.</p>
<p>As an example of the problem, a common (though fragile) Python idiom
for locating data files is to do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">foo.bar</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;my.dat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This would be problematic since <cite>foo.bar.__file__</cite> will give the
location of the <cite>pyc</cite> file in the shadow directory, and it may not be
possible to find the <cite>my.dat</cite> file relative to the source directory
from there.</p>
</section>
<section id="fat-byte-compilation-files">
<h3><a class="toc-backref" href="#fat-byte-compilation-files" role="doc-backlink">Fat byte compilation files</a></h3>
<p>An earlier version of this PEP described “fat” Python byte code files.
These files would contain the equivalent of multiple <cite>pyc</cite> files in a
single <cite>pyf</cite> file, with a lookup table keyed off the appropriate magic
number.  This was an extensible file format so that the first 5
parallel Python implementations could be supported fairly efficiently,
but with extension lookup tables available to scale <cite>pyf</cite> byte code
objects as large as necessary.</p>
<p>The fat byte compilation files were fairly complex, and inherently
introduced difficult race conditions, so the current simplification of
using directories was suggested.  The same problem applies to using
zip files as the fat pyc file format.</p>
</section>
<section id="multiple-file-extensions">
<h3><a class="toc-backref" href="#multiple-file-extensions" role="doc-backlink">Multiple file extensions</a></h3>
<p>The PEP author also considered an approach where multiple thin byte
compiled files lived in the same place, but used different file
extensions to designate the Python version.  E.g. foo.pyc25,
foo.pyc26, foo.pyc31 etc.  This was rejected because of the clutter
involved in writing so many different files.  The multiple extension
approach makes it more difficult (and an ongoing task) to update any
tools that are dependent on the file extension.</p>
</section>
<section id="pyc">
<h3><a class="toc-backref" href="#pyc" role="doc-backlink">.pyc</a></h3>
<p>A proposal was floated to call the <cite>__pycache__</cite> directory <cite>.pyc</cite> or
some other dot-file name.  This would have the effect on *nix systems
of hiding the directory.  There are many reasons why this was
rejected by the BDFL <a class="footnote-reference brackets" href="#id37" id="id18">[20]</a> including the fact that dot-files are only
special on some platforms, and we actually do <em>not</em> want to hide these
completely from users.</p>
</section>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation" role="doc-backlink">Reference implementation</a></h2>
<p>Work on this code is tracked in a Bazaar branch on Launchpad <a class="footnote-reference brackets" href="#id39" id="id19">[22]</a>
until it’s ready for merge into Python 3.2.  The work-in-progress diff
can also be viewed <a class="footnote-reference brackets" href="#id40" id="id20">[23]</a> and is updated automatically as new changes
are uploaded.</p>
<p>A Rietveld code review issue <a class="footnote-reference brackets" href="#id41" id="id21">[24]</a> has been opened as of 2010-04-01 (no,
this is not an April Fools joke :).</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#references" role="doc-backlink">References</a></h2>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id22" role="note">
<dt class="label" id="id22">[<a href="#id1">2</a>]</dt>
<dd>The marshal module:
<a class="reference external" href="https://docs.python.org/dev/library/marshal.html">https://docs.python.org/dev/library/marshal.html</a></aside>
<aside class="footnote brackets" id="id23" role="note">
<dt class="label" id="id23">[<a href="#id2">3</a>]</dt>
<dd>import.c:
<a class="reference external" href="http://svn.python.org/view/python/branches/py3k/Python/import.c?view=markup">http://svn.python.org/view/python/branches/py3k/Python/import.c?view=markup</a></aside>
<aside class="footnote brackets" id="id24" role="note">
<dt class="label" id="id24">[<a href="#id3">4</a>]</dt>
<dd>Ubuntu: &lt;<a class="reference external" href="http://www.ubuntu.com">http://www.ubuntu.com</a>&gt;</aside>
<aside class="footnote brackets" id="id25" role="note">
<dt class="label" id="id25">[<a href="#id4">5</a>]</dt>
<dd>Debian: &lt;<a class="reference external" href="http://www.debian.org">http://www.debian.org</a>&gt;</aside>
<aside class="footnote brackets" id="id26" role="note">
<dt class="label" id="id26">[<a href="#id5">6</a>]</dt>
<dd>Debian Python Policy:
<a class="reference external" href="http://www.debian.org/doc/packaging-manuals/python-policy/">http://www.debian.org/doc/packaging-manuals/python-policy/</a></aside>
<aside class="footnote brackets" id="id27" role="note">
<dt class="label" id="id27">[<a href="#id6">8</a>]</dt>
<dd>python-support:
<a class="reference external" href="http://wiki.debian.org/DebianPythonFAQ#Whatispython-support.3F">http://wiki.debian.org/DebianPythonFAQ#Whatispython-support.3F</a></aside>
<aside class="footnote brackets" id="id28" role="note">
<dt class="label" id="id28">[<a href="#id7">9</a>]</dt>
<dd>python-central:
<a class="reference external" href="http://wiki.debian.org/DebianPythonFAQ#Whatispython-central.3F">http://wiki.debian.org/DebianPythonFAQ#Whatispython-central.3F</a></aside>
<aside class="footnote brackets" id="id29" role="note">
<dt class="label" id="id29">[<a href="#id17">10</a>]</dt>
<dd>binascii.hexlify():
<a class="reference external" href="http://www.python.org/doc/current/library/binascii.html#binascii.hexlify">http://www.python.org/doc/current/library/binascii.html#binascii.hexlify</a></aside>
<aside class="footnote brackets" id="id30" role="note">
<dt class="label" id="id30">[<a href="#id10">11</a>]</dt>
<dd>Jython: <a class="reference external" href="http://www.jython.org/">http://www.jython.org/</a></aside>
<aside class="footnote brackets" id="id31" role="note">
<dt class="label" id="id31">[<a href="#id11">12</a>]</dt>
<dd>IronPython: <a class="reference external" href="http://ironpython.net/">http://ironpython.net/</a></aside>
<aside class="footnote brackets" id="id32" role="note">
<dt class="label" id="id32">[<a href="#id12">13</a>]</dt>
<dd>PyPy: <a class="reference external" href="http://codespeak.net/pypy/dist/pypy/doc/">http://codespeak.net/pypy/dist/pypy/doc/</a></aside>
<aside class="footnote brackets" id="id33" role="note">
<dt class="label" id="id33">[<a href="#id13">14</a>]</dt>
<dd>Pynie: <a class="reference external" href="http://code.google.com/p/pynie/">http://code.google.com/p/pynie/</a></aside>
<aside class="footnote brackets" id="id34" role="note">
<dt class="label" id="id34">[15]<em> (<a href='#id8'>1</a>, <a href='#id14'>2</a>) </em></dt>
<dd>py_compile: <a class="reference external" href="http://docs.python.org/library/py_compile.html">http://docs.python.org/library/py_compile.html</a></aside>
<aside class="footnote brackets" id="id35" role="note">
<dt class="label" id="id35">[16]<em> (<a href='#id9'>1</a>, <a href='#id15'>2</a>) </em></dt>
<dd>compileall: <a class="reference external" href="http://docs.python.org/library/compileall.html">http://docs.python.org/library/compileall.html</a></aside>
<aside class="footnote brackets" id="id36" role="note">
<dt class="label" id="id36">[<a href="#id16">17</a>]</dt>
<dd>imp: <a class="reference external" href="http://www.python.org/doc/current/library/imp.html">http://www.python.org/doc/current/library/imp.html</a></aside>
<aside class="footnote brackets" id="id37" role="note">
<dt class="label" id="id37">[<a href="#id18">20</a>]</dt>
<dd><a class="reference external" href="http://www.mail-archive.com/python-dev&#64;python.org/msg45203.html">http://www.mail-archive.com/python-dev&#64;python.org/msg45203.html</a></aside>
<aside class="footnote brackets" id="id38" role="note">
<dt class="label" id="id38">[21]</dt>
<dd>importlib: <a class="reference external" href="http://docs.python.org/3.1/library/importlib.html">http://docs.python.org/3.1/library/importlib.html</a></aside>
<aside class="footnote brackets" id="id39" role="note">
<dt class="label" id="id39">[<a href="#id19">22</a>]</dt>
<dd><a class="reference external" href="https://code.launchpad.net/~barry/python/pep3147">https://code.launchpad.net/~barry/python/pep3147</a></aside>
<aside class="footnote brackets" id="id40" role="note">
<dt class="label" id="id40">[<a href="#id20">23</a>]</dt>
<dd><a class="reference external" href="https://code.launchpad.net/~barry/python/pep3147/+merge/22648">https://code.launchpad.net/~barry/python/pep3147/+merge/22648</a></aside>
<aside class="footnote brackets" id="id41" role="note">
<dt class="label" id="id41">[<a href="#id21">24</a>]</dt>
<dd><a class="reference external" href="http://codereview.appspot.com/842043/show">http://codereview.appspot.com/842043/show</a></aside>
</aside>
</section>
<section id="acknowledgments">
<h2><a class="toc-backref" href="#acknowledgments" role="doc-backlink">ACKNOWLEDGMENTS</a></h2>
<p>Barry Warsaw’s original idea was for fat Python byte code files.
Martin von Loewis reviewed an early draft of the PEP and suggested the
simplification to store traditional <cite>pyc</cite> and <cite>pyo</cite> files in a
directory.  Many other people reviewed early versions of this PEP and
provided useful feedback including but not limited to:</p>
<ul class="simple">
<li>David Malcolm</li>
<li>Josselin Mouette</li>
<li>Matthias Klose</li>
<li>Michael Hudson</li>
<li>Michael Vogt</li>
<li>Piotr Ożarowski</li>
<li>Scott Kitterman</li>
<li>Toshio Kuratomi</li>
</ul>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright" role="doc-backlink">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/pep-3147.txt">https://github.com/python/peps/blob/main/pep-3147.txt</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/pep-3147.txt">2022-03-11 20:41:57 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#proposal">Proposal</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-behavior">Python behavior</a><ul>
<li><a class="reference internal" href="#case-0-the-steady-state">Case 0: The steady state</a></li>
<li><a class="reference internal" href="#case-1-the-first-import">Case 1: The first import</a></li>
<li><a class="reference internal" href="#case-2-the-second-import">Case 2: The second import</a></li>
<li><a class="reference internal" href="#case-3-pycache-foo-magic-pyc-with-no-source">Case 3: __pycache__/foo.&lt;magic&gt;.pyc with no source</a></li>
<li><a class="reference internal" href="#case-4-legacy-pyc-files-and-source-less-imports">Case 4: legacy pyc files and source-less imports</a></li>
<li><a class="reference internal" href="#case-5-read-only-file-systems">Case 5: read-only file systems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flow-chart">Flow chart</a></li>
<li><a class="reference internal" href="#alternative-python-implementations">Alternative Python implementations</a></li>
<li><a class="reference internal" href="#implementation-strategy">Implementation strategy</a></li>
<li><a class="reference internal" href="#effects-on-existing-code">Effects on existing code</a><ul>
<li><a class="reference internal" href="#detecting-pep-3147-availability">Detecting PEP 3147 availability</a></li>
<li><a class="reference internal" href="#file">__file__</a></li>
<li><a class="reference internal" href="#py-compile-and-compileall">py_compile and compileall</a></li>
<li><a class="reference internal" href="#bdist-wininst-and-the-windows-installer">bdist_wininst and the Windows installer</a></li>
<li><a class="reference internal" href="#file-extension-checks">File extension checks</a></li>
<li><a class="reference internal" href="#backports">Backports</a></li>
<li><a class="reference internal" href="#makefiles-and-other-dependency-tools">Makefiles and other dependency tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#alternatives">Alternatives</a><ul>
<li><a class="reference internal" href="#hexadecimal-magic-tags">Hexadecimal magic tags</a></li>
<li><a class="reference internal" href="#pep-304">PEP 304</a></li>
<li><a class="reference internal" href="#fat-byte-compilation-files">Fat byte compilation files</a></li>
<li><a class="reference internal" href="#multiple-file-extensions">Multiple file extensions</a></li>
<li><a class="reference internal" href="#pyc">.pyc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-implementation">Reference implementation</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#acknowledgments">ACKNOWLEDGMENTS</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br>
            <a id="source" href="https://github.com/python/peps/blob/main/pep-3147.txt">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
</body>
</html>